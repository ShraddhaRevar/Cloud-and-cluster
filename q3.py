import os
import pprint
from datetime import datetime, timezone, timedelta
from pymongo import MongoClient

MONGODB_URL = os.getenv('MONGODB_URL', default='mongodb://admin:supersecret@127.0.0.1:27017/?authSource=admin')

def get_mongo(conn_str, db):
    return MongoClient(conn_str)[db]

def get_station_info_aggregate(station_name):
    return [
        {
            '$project': {
                'highwayid': 1, 
                'stationlist': {
                    '$filter': {
                        'input': '$stationlist',
                        'as': 'station',
                        'cond': { '$eq': ['$$station.locationtext', station_name] },
                    },
                },
            },
        },
        { '$unwind': '$stationlist' },
        { '$unwind': '$stationlist.detectorlist' },
        {
            '$group': {
                '_id': {
                    'highwayid': '$highwayid',
                    'stationid': '$stationlist.stationid',
                },
                'length': { '$first': { '$toDouble': '$stationlist.length' } },
                'detectorlist': {
                    '$push': '$stationlist.detectorlist',
                },
            },
        },
    ]

def get_average_speed_per_5_minutes(detector_id_list, distance):
    detectors = list(map(lambda d: { 'detectorid': d['detectorid'] }, detector_id_list))
    return [
        {
            '$match': {
                '$and': [
                    {
                        '$or': detectors,
                    },
                    {
                        'speed': { '$ne': 0 },
                    },
                    {
                        'starttime': {
                            '$gte': datetime(2011, 9, 15, 0, 0, 0, 0, timezone(timedelta(hours=-7))),
                            '$lt':  datetime(2011, 9, 16, 0, 0, 0, 0, timezone(timedelta(hours=-7))),
                        },
                    },
                ],
            },
        },
        {
            '$group': {
                '_id': {
                    '$dateToString': {
                        'date': {
                            '$toDate': {
                                '$subtract': [
                                    { '$toLong': '$starttime' },
                                    { '$mod': [ { '$toLong': '$starttime' }, 1000 * 60 * 5 ] },
                                ],
                            },
                        },
                        'timezone': '-07:00',
                    },
                },
                'avg_speed': { '$avg': '$speed' },
            },
        },
        {
            '$addFields': {
                'travel_time': {
                    '$multiply': [
                        { '$divide': [ distance, '$avg_speed' ] },
                        3600,
                    ],
                },
            }
        },
        {
            '$sort': { '_id': 1 },
        },
    ]

if __name__ == '__main__':
    db = get_mongo(MONGODB_URL, 'freeway')
    # 1. Get detectors for Foster NB station
    station_list = list(db.highway.aggregate(get_station_info_aggregate('Foster NB')))
    pprint.pprint(station_list)
    # 2. Compute average speed per 5 minute interval for the detectors
    detector_list = station_list[0]['detectorlist'] if len(station_list) > 0 else []
    distance = station_list[0]['length'] if len(station_list) > 0 else 0
    average_speed_list = list(db.loopdata.aggregate(get_average_speed_per_5_minutes(detector_list, distance)))
    pprint.pprint(average_speed_list)

# Result:
#[{'_id': '2011-09-15T00:00:00.000Z',
#  'avg_speed': 59.9,
#  'travel_time': 96.16026711185309},
# {'_id': '2011-09-15T00:05:00.000Z',
#  'avg_speed': 61.58620689655172,
#  'travel_time': 93.52743561030236},
# {'_id': '2011-09-15T00:10:00.000Z',
#  'avg_speed': 59.583333333333336,
#  'travel_time': 96.67132867132867},
# {'_id': '2011-09-15T00:15:00.000Z',
#  'avg_speed': 60.45161290322581,
#  'travel_time': 95.2828175026681},
# {'_id': '2011-09-15T00:20:00.000Z',
#  'avg_speed': 59.205882352941174,
#  'travel_time': 97.28763040238451},
# {'_id': '2011-09-15T00:25:00.000Z',
#  'avg_speed': 59.92307692307692,
#  'travel_time': 96.12323491655971},
# {'_id': '2011-09-15T00:30:00.000Z',
#  'avg_speed': 58.7037037037037,
#  'travel_time': 98.1198738170347},
# {'_id': '2011-09-15T00:35:00.000Z',
#  'avg_speed': 58.43478260869565,
#  'travel_time': 98.57142857142858},
# {'_id': '2011-09-15T00:40:00.000Z',
#  'avg_speed': 64.14285714285714,
#  'travel_time': 89.79955456570157},
# {'_id': '2011-09-15T00:45:00.000Z',
#  'avg_speed': 60.23076923076923,
#  'travel_time': 95.63218390804597},
# {'_id': '2011-09-15T00:50:00.000Z',
#  'avg_speed': 63.588235294117645,
#  'travel_time': 90.58279370952822},
# {'_id': '2011-09-15T00:55:00.000Z',
#  'avg_speed': 58.07142857142857,
#  'travel_time': 99.18819188191883},
# {'_id': '2011-09-15T01:00:00.000Z',
#  'avg_speed': 59.275862068965516,
#  'travel_time': 97.17277486910996},
# {'_id': '2011-09-15T01:05:00.000Z',
#  'avg_speed': 57.55,
#  'travel_time': 100.08688097306691},
# {'_id': '2011-09-15T01:10:00.000Z',
#  'avg_speed': 59.26923076923077,
#  'travel_time': 97.18364698247892},
# {'_id': '2011-09-15T01:15:00.000Z',
#  'avg_speed': 61.27777777777778,
#  'travel_time': 93.99818676337262},
# {'_id': '2011-09-15T01:20:00.000Z',
#  'avg_speed': 57.148148148148145,
#  'travel_time': 100.79066753078419},
# {'_id': '2011-09-15T01:25:00.000Z',
#  'avg_speed': 63.1,
#  'travel_time': 91.28367670364501},
# {'_id': '2011-09-15T01:30:00.000Z',
#  'avg_speed': 64.07692307692308,
#  'travel_time': 89.89195678271308},
# {'_id': '2011-09-15T01:35:00.000Z',
#  'avg_speed': 58.333333333333336,
#  'travel_time': 98.74285714285715},
# {'_id': '2011-09-15T01:40:00.000Z',
#  'avg_speed': 61.833333333333336,
#  'travel_time': 93.15363881401618},
# {'_id': '2011-09-15T01:45:00.000Z',
#  'avg_speed': 55.875,
#  'travel_time': 103.08724832214766},
# {'_id': '2011-09-15T01:50:00.000Z',
#  'avg_speed': 60.18181818181818,
#  'travel_time': 95.70996978851964},
# {'_id': '2011-09-15T01:55:00.000Z',
#  'avg_speed': 63.90909090909091,
#  'travel_time': 90.1280227596017},
# {'_id': '2011-09-15T02:00:00.000Z',
#  'avg_speed': 60.857142857142854,
#  'travel_time': 94.64788732394366},
# {'_id': '2011-09-15T02:05:00.000Z',
#  'avg_speed': 58.25,
#  'travel_time': 98.88412017167383},
# {'_id': '2011-09-15T02:10:00.000Z',
#  'avg_speed': 62.18518518518518,
#  'travel_time': 92.62656343061346},
# {'_id': '2011-09-15T02:15:00.000Z',
#  'avg_speed': 61.4,
#  'travel_time': 93.81107491856677},
# {'_id': '2011-09-15T02:20:00.000Z',
#  'avg_speed': 58.72222222222222,
#  'travel_time': 98.08893093661307},
# {'_id': '2011-09-15T02:25:00.000Z',
#  'avg_speed': 56.2,
#  'travel_time': 102.49110320284697},
# {'_id': '2011-09-15T02:30:00.000Z',
#  'avg_speed': 59.391304347826086,
#  'travel_time': 96.98389458272328},
# {'_id': '2011-09-15T02:35:00.000Z',
#  'avg_speed': 60.36842105263158,
#  'travel_time': 95.41412380122058},
# {'_id': '2011-09-15T02:40:00.000Z',
#  'avg_speed': 59.5,
#  'travel_time': 96.80672268907564},
# {'_id': '2011-09-15T02:45:00.000Z',
#  'avg_speed': 58.5,
#  'travel_time': 98.46153846153847},
# {'_id': '2011-09-15T02:50:00.000Z', 'avg_speed': 64.0, 'travel_time': 90.0},
# {'_id': '2011-09-15T02:55:00.000Z',
#  'avg_speed': 60.44444444444444,
#  'travel_time': 95.29411764705884},
# {'_id': '2011-09-15T03:00:00.000Z',
#  'avg_speed': 61.04761904761905,
#  'travel_time': 94.35257410296411},
# {'_id': '2011-09-15T03:05:00.000Z',
#  'avg_speed': 59.391304347826086,
#  'travel_time': 96.98389458272328},
# {'_id': '2011-09-15T03:10:00.000Z',
#  'avg_speed': 64.07692307692308,
#  'travel_time': 89.89195678271308},
# {'_id': '2011-09-15T03:15:00.000Z',
#  'avg_speed': 57.86363636363637,
#  'travel_time': 99.54438334642578},
# {'_id': '2011-09-15T03:20:00.000Z',
#  'avg_speed': 60.81481481481482,
#  'travel_time': 94.71376370280147},
# {'_id': '2011-09-15T03:25:00.000Z',
#  'avg_speed': 58.916666666666664,
#  'travel_time': 97.76520509193777},
# {'_id': '2011-09-15T03:30:00.000Z',
#  'avg_speed': 58.61904761904762,
#  'travel_time': 98.26157595450853},
# {'_id': '2011-09-15T03:35:00.000Z',
#  'avg_speed': 61.18518518518518,
#  'travel_time': 94.1404358353511},
# {'_id': '2011-09-15T03:40:00.000Z',
#  'avg_speed': 64.19444444444444,
#  'travel_time': 89.72739073993944},
# {'_id': '2011-09-15T03:45:00.000Z',
#  'avg_speed': 63.1,
#  'travel_time': 91.28367670364501},
# {'_id': '2011-09-15T03:50:00.000Z',
#  'avg_speed': 63.6551724137931,
#  'travel_time': 90.4875406283857},
# {'_id': '2011-09-15T03:55:00.000Z',
#  'avg_speed': 61.214285714285715,
#  'travel_time': 94.09568261376896},
# {'_id': '2011-09-15T04:00:00.000Z',
#  'avg_speed': 59.5,
#  'travel_time': 96.80672268907564},
# {'_id': '2011-09-15T04:05:00.000Z',
#  'avg_speed': 60.06896551724138,
#  'travel_time': 95.88978185993112},
# {'_id': '2011-09-15T04:10:00.000Z',
#  'avg_speed': 59.94871794871795,
#  'travel_time': 96.08212147134303},
# {'_id': '2011-09-15T04:15:00.000Z',
#  'avg_speed': 52.5,
#  'travel_time': 109.71428571428571},
# {'_id': '2011-09-15T08:50:00.000Z',
#  'avg_speed': 23.0,
#  'travel_time': 250.43478260869566},
# {'_id': '2011-09-15T08:55:00.000Z',
#  'avg_speed': 24.6,
#  'travel_time': 234.14634146341461},
# {'_id': '2011-09-15T09:00:00.000Z',
#  'avg_speed': 45.37777777777778,
#  'travel_time': 126.93437806072478},
# {'_id': '2011-09-15T09:05:00.000Z',
#  'avg_speed': 59.4,
#  'travel_time': 96.96969696969698},
# {'_id': '2011-09-15T09:10:00.000Z',
#  'avg_speed': 57.022222222222226,
#  'travel_time': 101.0132501948558},
# {'_id': '2011-09-15T09:15:00.000Z',
#  'avg_speed': 60.37777777777778,
#  'travel_time': 95.39933750460067},
# {'_id': '2011-09-15T09:20:00.000Z',
#  'avg_speed': 56.15555555555556,
#  'travel_time': 102.57222002374357},
# {'_id': '2011-09-15T09:25:00.000Z',
#  'avg_speed': 56.977777777777774,
#  'travel_time': 101.09204368174728},
# {'_id': '2011-09-15T09:30:00.000Z',
#  'avg_speed': 60.45454545454545,
#  'travel_time': 95.2781954887218},
# {'_id': '2011-09-15T09:35:00.000Z',
#  'avg_speed': 58.404761904761905,
#  'travel_time': 98.62209539339584},
# {'_id': '2011-09-15T09:40:00.000Z',
#  'avg_speed': 58.333333333333336,
#  'travel_time': 98.74285714285715},
# {'_id': '2011-09-15T09:45:00.000Z',
#  'avg_speed': 57.48888888888889,
#  'travel_time': 100.1932740626208},
# {'_id': '2011-09-15T09:50:00.000Z',
#  'avg_speed': 57.888888888888886,
#  'travel_time': 99.50095969289828},
# {'_id': '2011-09-15T09:55:00.000Z',
#  'avg_speed': 57.36363636363637,
#  'travel_time': 100.41204437400951},
# {'_id': '2011-09-15T10:00:00.000Z',
#  'avg_speed': 59.857142857142854,
#  'travel_time': 96.2291169451074},
# {'_id': '2011-09-15T10:05:00.000Z',
#  'avg_speed': 58.48888888888889,
#  'travel_time': 98.48024316109424},
# {'_id': '2011-09-15T10:10:00.000Z',
#  'avg_speed': 58.24444444444445,
#  'travel_time': 98.89355207935903},
# {'_id': '2011-09-15T10:15:00.000Z',
#  'avg_speed': 62.022222222222226,
#  'travel_time': 92.86993908993192},
# {'_id': '2011-09-15T10:20:00.000Z',
#  'avg_speed': 58.111111111111114,
#  'travel_time': 99.12045889101339},
# {'_id': '2011-09-15T10:25:00.000Z',
#  'avg_speed': 59.71111111111111,
#  'travel_time': 96.46445850390772},
# {'_id': '2011-09-15T10:30:00.000Z',
#  'avg_speed': 57.62222222222222,
#  'travel_time': 99.96143463170074},
# {'_id': '2011-09-15T10:35:00.000Z',
#  'avg_speed': 58.37777777777778,
#  'travel_time': 98.66768176627332},
# {'_id': '2011-09-15T10:40:00.000Z',
#  'avg_speed': 57.8,
#  'travel_time': 99.65397923875435},
# {'_id': '2011-09-15T10:45:00.000Z',
#  'avg_speed': 58.15555555555556,
#  'travel_time': 99.04470768055025},
# {'_id': '2011-09-15T10:50:00.000Z',
#  'avg_speed': 56.48888888888889,
#  'travel_time': 101.96695515342252},
# {'_id': '2011-09-15T10:55:00.000Z',
#  'avg_speed': 57.91111111111111,
#  'travel_time': 99.46277820414429},
# {'_id': '2011-09-15T11:00:00.000Z',
#  'avg_speed': 61.84444444444444,
#  'travel_time': 93.13690262306864},
# {'_id': '2011-09-15T11:05:00.000Z',
#  'avg_speed': 58.422222222222224,
#  'travel_time': 98.59262076835299},
# {'_id': '2011-09-15T11:10:00.000Z',
#  'avg_speed': 58.48888888888889,
#  'travel_time': 98.48024316109424},
# {'_id': '2011-09-15T11:15:00.000Z',
#  'avg_speed': 60.6,
#  'travel_time': 95.04950495049505},
# {'_id': '2011-09-15T11:20:00.000Z', 'avg_speed': 57.6, 'travel_time': 100.0},
# {'_id': '2011-09-15T11:25:00.000Z',
#  'avg_speed': 57.644444444444446,
#  'travel_time': 99.92289899768697},
# {'_id': '2011-09-15T11:30:00.000Z',
#  'avg_speed': 59.666666666666664,
#  'travel_time': 96.53631284916202},
# {'_id': '2011-09-15T11:35:00.000Z',
#  'avg_speed': 60.37777777777778,
#  'travel_time': 95.39933750460067},
# {'_id': '2011-09-15T11:40:00.000Z',
#  'avg_speed': 59.111111111111114,
#  'travel_time': 97.44360902255639},
# {'_id': '2011-09-15T11:45:00.000Z',
#  'avg_speed': 58.2,
#  'travel_time': 98.96907216494846},
# {'_id': '2011-09-15T11:50:00.000Z',
#  'avg_speed': 59.47727272727273,
#  'travel_time': 96.84371417653803},
# {'_id': '2011-09-15T11:55:00.000Z',
#  'avg_speed': 58.17777777777778,
#  'travel_time': 99.00687547746371},
# {'_id': '2011-09-15T12:00:00.000Z',
#  'avg_speed': 57.53333333333333,
#  'travel_time': 100.11587485515645},
# {'_id': '2011-09-15T12:05:00.000Z',
#  'avg_speed': 59.13333333333333,
#  'travel_time': 97.40698985343856},
# {'_id': '2011-09-15T12:10:00.000Z',
#  'avg_speed': 59.86666666666667,
#  'travel_time': 96.21380846325167},
# {'_id': '2011-09-15T12:15:00.000Z',
#  'avg_speed': 58.733333333333334,
#  'travel_time': 98.07037457434734},
# {'_id': '2011-09-15T12:20:00.000Z',
#  'avg_speed': 58.68888888888889,
#  'travel_time': 98.14464218099205},
# {'_id': '2011-09-15T12:25:00.000Z',
#  'avg_speed': 58.644444444444446,
#  'travel_time': 98.21902235695339},
# {'_id': '2011-09-15T12:30:00.000Z',
#  'avg_speed': 57.28888888888889,
#  'travel_time': 100.54305663304888},
# {'_id': '2011-09-15T12:35:00.000Z',
#  'avg_speed': 57.53333333333333,
#  'travel_time': 100.11587485515645},
# {'_id': '2011-09-15T12:40:00.000Z',
#  'avg_speed': 52.46666666666667,
#  'travel_time': 109.78398983481576},
# {'_id': '2011-09-15T12:45:00.000Z',
#  'avg_speed': 60.82222222222222,
#  'travel_time': 94.70222871757399},
# {'_id': '2011-09-15T12:50:00.000Z',
#  'avg_speed': 57.51111111111111,
#  'travel_time': 100.15455950540958},
# {'_id': '2011-09-15T12:55:00.000Z',
#  'avg_speed': 56.75555555555555,
#  'travel_time': 101.4878621769773},
# {'_id': '2011-09-15T13:00:00.000Z', 'avg_speed': 56.25, 'travel_time': 102.4},
# {'_id': '2011-09-15T13:05:00.000Z',
#  'avg_speed': 57.91111111111111,
#  'travel_time': 99.46277820414429},
# {'_id': '2011-09-15T13:10:00.000Z',
#  'avg_speed': 57.955555555555556,
#  'travel_time': 99.38650306748467},
# {'_id': '2011-09-15T13:15:00.000Z',
#  'avg_speed': 57.666666666666664,
#  'travel_time': 99.88439306358383},
# {'_id': '2011-09-15T13:20:00.000Z',
#  'avg_speed': 59.333333333333336,
#  'travel_time': 97.07865168539325},
# {'_id': '2011-09-15T13:25:00.000Z',
#  'avg_speed': 58.022222222222226,
#  'travel_time': 99.27230945997701},
# {'_id': '2011-09-15T13:30:00.000Z',
#  'avg_speed': 58.977777777777774,
#  'travel_time': 97.66390354182367},
# {'_id': '2011-09-15T13:35:00.000Z',
#  'avg_speed': 57.93333333333333,
#  'travel_time': 99.42462600690449},
# {'_id': '2011-09-15T13:40:00.000Z',
#  'avg_speed': 59.6,
#  'travel_time': 96.64429530201342},
# {'_id': '2011-09-15T13:45:00.000Z',
#  'avg_speed': 60.044444444444444,
#  'travel_time': 95.92894152479644},
# {'_id': '2011-09-15T13:50:00.000Z',
#  'avg_speed': 58.15555555555556,
#  'travel_time': 99.04470768055025},
# {'_id': '2011-09-15T13:55:00.000Z',
#  'avg_speed': 58.53333333333333,
#  'travel_time': 98.40546697038725},
# {'_id': '2011-09-15T14:00:00.000Z',
#  'avg_speed': 57.77777777777778,
#  'travel_time': 99.6923076923077},
# {'_id': '2011-09-15T14:05:00.000Z',
#  'avg_speed': 58.91111111111111,
#  'travel_time': 97.77442474537911},
# {'_id': '2011-09-15T14:10:00.000Z',
#  'avg_speed': 54.13333333333333,
#  'travel_time': 106.40394088669952},
# {'_id': '2011-09-15T14:15:00.000Z',
#  'avg_speed': 48.111111111111114,
#  'travel_time': 119.72286374133951},
# {'_id': '2011-09-15T14:20:00.000Z',
#  'avg_speed': 28.0,
#  'travel_time': 205.71428571428572},
# {'_id': '2011-09-15T14:25:00.000Z',
#  'avg_speed': 30.57777777777778,
#  'travel_time': 188.37209302325581},
# {'_id': '2011-09-15T14:30:00.000Z',
#  'avg_speed': 36.577777777777776,
#  'travel_time': 157.47266099635482},
# {'_id': '2011-09-15T14:35:00.000Z',
#  'avg_speed': 52.43589743589744,
#  'travel_time': 109.84841075794621},
# {'_id': '2011-09-15T14:40:00.000Z',
#  'avg_speed': 55.577777777777776,
#  'travel_time': 103.63854458216714},
# {'_id': '2011-09-15T14:45:00.000Z',
#  'avg_speed': 57.333333333333336,
#  'travel_time': 100.46511627906976},
# {'_id': '2011-09-15T14:50:00.000Z',
#  'avg_speed': 54.55555555555556,
#  'travel_time': 105.58044806517312},
# {'_id': '2011-09-15T14:55:00.000Z',
#  'avg_speed': 38.57142857142857,
#  'travel_time': 149.33333333333334},
# {'_id': '2011-09-15T15:00:00.000Z',
#  'avg_speed': 49.577777777777776,
#  'travel_time': 116.18108471537427},
# {'_id': '2011-09-15T15:05:00.000Z',
#  'avg_speed': 57.62222222222222,
#  'travel_time': 99.96143463170074},
# {'_id': '2011-09-15T15:10:00.000Z',
#  'avg_speed': 57.53333333333333,
#  'travel_time': 100.11587485515645},
# {'_id': '2011-09-15T15:15:00.000Z',
#  'avg_speed': 53.68888888888889,
#  'travel_time': 107.28476821192052},
# {'_id': '2011-09-15T15:20:00.000Z',
#  'avg_speed': 53.357142857142854,
#  'travel_time': 107.95180722891567},
# {'_id': '2011-09-15T15:25:00.000Z',
#  'avg_speed': 55.61538461538461,
#  'travel_time': 103.56846473029046},
# {'_id': '2011-09-15T15:30:00.000Z',
#  'avg_speed': 55.15384615384615,
#  'travel_time': 104.43514644351465},
# {'_id': '2011-09-15T15:35:00.000Z',
#  'avg_speed': 56.30555555555556,
#  'travel_time': 102.2989639861865},
# {'_id': '2011-09-15T15:40:00.000Z',
#  'avg_speed': 50.69444444444444,
#  'travel_time': 113.6219178082192},
# {'_id': '2011-09-15T15:45:00.000Z',
#  'avg_speed': 48.416666666666664,
#  'travel_time': 118.9672977624785},
# {'_id': '2011-09-15T15:50:00.000Z',
#  'avg_speed': 35.404761904761905,
#  'travel_time': 162.68997982515134},
# {'_id': '2011-09-15T15:55:00.000Z',
#  'avg_speed': 33.0,
#  'travel_time': 174.54545454545453},
# {'_id': '2011-09-15T16:00:00.000Z', 'avg_speed': 50.0, 'travel_time': 115.2},
# {'_id': '2011-09-15T16:05:00.000Z',
#  'avg_speed': 50.55555555555556,
#  'travel_time': 113.93406593406593},
# {'_id': '2011-09-15T16:10:00.000Z',
#  'avg_speed': 31.466666666666665,
#  'travel_time': 183.05084745762713},
# {'_id': '2011-09-15T16:15:00.000Z',
#  'avg_speed': 47.851851851851855,
#  'travel_time': 120.37151702786377},
# {'_id': '2011-09-15T16:20:00.000Z',
#  'avg_speed': 56.56666666666667,
#  'travel_time': 101.82675309369476},
# {'_id': '2011-09-15T16:25:00.000Z',
#  'avg_speed': 49.611111111111114,
#  'travel_time': 116.1030235162374},
# {'_id': '2011-09-15T16:30:00.000Z',
#  'avg_speed': 55.416666666666664,
#  'travel_time': 103.93984962406016},
# {'_id': '2011-09-15T16:35:00.000Z',
#  'avg_speed': 51.878787878787875,
#  'travel_time': 111.02803738317758},
# {'_id': '2011-09-15T16:40:00.000Z',
#  'avg_speed': 46.791666666666664,
#  'travel_time': 123.09884238646484},
# {'_id': '2011-09-15T16:45:00.000Z',
#  'avg_speed': 34.97222222222222,
#  'travel_time': 164.70214455917397},
# {'_id': '2011-09-15T16:50:00.000Z',
#  'avg_speed': 38.80555555555556,
#  'travel_time': 148.4323550465283},
# {'_id': '2011-09-15T16:55:00.000Z',
#  'avg_speed': 55.0,
#  'travel_time': 104.72727272727273},
# {'_id': '2011-09-15T17:00:00.000Z',
#  'avg_speed': 51.52777777777778,
#  'travel_time': 111.78436657681942},
# {'_id': '2011-09-15T17:05:00.000Z',
#  'avg_speed': 55.52777777777778,
#  'travel_time': 103.73186593296649},
# {'_id': '2011-09-15T17:10:00.000Z',
#  'avg_speed': 52.31111111111111,
#  'travel_time': 110.1104502973662},
# {'_id': '2011-09-15T17:15:00.000Z',
#  'avg_speed': 55.22222222222222,
#  'travel_time': 104.30583501006036},
# {'_id': '2011-09-15T17:20:00.000Z',
#  'avg_speed': 56.256410256410255,
#  'travel_time': 102.3883318140383},
# {'_id': '2011-09-15T17:25:00.000Z',
#  'avg_speed': 55.361111111111114,
#  'travel_time': 104.04415454089313},
# {'_id': '2011-09-15T17:30:00.000Z',
#  'avg_speed': 55.5,
#  'travel_time': 103.78378378378379},
# {'_id': '2011-09-15T17:35:00.000Z',
#  'avg_speed': 55.791666666666664,
#  'travel_time': 103.24122479462287},
# {'_id': '2011-09-15T17:40:00.000Z',
#  'avg_speed': 56.81818181818182,
#  'travel_time': 101.376},
# {'_id': '2011-09-15T17:45:00.000Z',
#  'avg_speed': 58.8,
#  'travel_time': 97.9591836734694},
# {'_id': '2011-09-15T17:50:00.000Z',
#  'avg_speed': 57.355555555555554,
#  'travel_time': 100.42619139868269},
# {'_id': '2011-09-15T17:55:00.000Z',
#  'avg_speed': 56.95238095238095,
#  'travel_time': 101.13712374581941},
# {'_id': '2011-09-15T18:00:00.000Z',
#  'avg_speed': 57.15909090909091,
#  'travel_time': 100.7713717693837},
# {'_id': '2011-09-15T18:05:00.000Z',
#  'avg_speed': 57.17777777777778,
#  'travel_time': 100.73843762145356},
# {'_id': '2011-09-15T18:10:00.000Z',
#  'avg_speed': 56.06666666666667,
#  'travel_time': 102.73483947681332},
# {'_id': '2011-09-15T18:15:00.000Z',
#  'avg_speed': 57.82222222222222,
#  'travel_time': 99.61568024596465},
# {'_id': '2011-09-15T18:20:00.000Z',
#  'avg_speed': 57.73809523809524,
#  'travel_time': 99.76082474226804},
# {'_id': '2011-09-15T18:25:00.000Z',
#  'avg_speed': 58.714285714285715,
#  'travel_time': 98.10218978102189},
# {'_id': '2011-09-15T18:30:00.000Z',
#  'avg_speed': 41.61904761904762,
#  'travel_time': 138.39816933638443},
# {'_id': '2011-09-15T18:35:00.000Z',
#  'avg_speed': 24.666666666666668,
#  'travel_time': 233.51351351351352},
# {'_id': '2011-09-15T18:40:00.000Z',
#  'avg_speed': 20.6,
#  'travel_time': 279.6116504854369},
# {'_id': '2011-09-15T18:45:00.000Z',
#  'avg_speed': 18.822222222222223,
#  'travel_time': 306.02125147579693},
# {'_id': '2011-09-15T18:50:00.000Z',
#  'avg_speed': 23.866666666666667,
#  'travel_time': 241.340782122905},
# {'_id': '2011-09-15T18:55:00.000Z',
#  'avg_speed': 33.266666666666666,
#  'travel_time': 173.14629258517036},
# {'_id': '2011-09-15T19:00:00.000Z',
#  'avg_speed': 54.56818181818182,
#  'travel_time': 105.55601832569764},
# {'_id': '2011-09-15T19:05:00.000Z',
#  'avg_speed': 57.62222222222222,
#  'travel_time': 99.96143463170074},
# {'_id': '2011-09-15T19:10:00.000Z',
#  'avg_speed': 59.22222222222222,
#  'travel_time': 97.26078799249532},
# {'_id': '2011-09-15T19:15:00.000Z',
#  'avg_speed': 59.37777777777778,
#  'travel_time': 97.0059880239521},
# {'_id': '2011-09-15T19:20:00.000Z',
#  'avg_speed': 59.111111111111114,
#  'travel_time': 97.44360902255639},
# {'_id': '2011-09-15T19:25:00.000Z',
#  'avg_speed': 60.24444444444445,
#  'travel_time': 95.61047583917374},
# {'_id': '2011-09-15T19:30:00.000Z',
#  'avg_speed': 58.888888888888886,
#  'travel_time': 97.81132075471699},
# {'_id': '2011-09-15T19:35:00.000Z',
#  'avg_speed': 58.75555555555555,
#  'travel_time': 98.03328290468987},
# {'_id': '2011-09-15T19:40:00.000Z',
#  'avg_speed': 57.2,
#  'travel_time': 100.6993006993007},
# {'_id': '2011-09-15T19:45:00.000Z',
#  'avg_speed': 58.84444444444444,
#  'travel_time': 97.88519637462237},
# {'_id': '2011-09-15T19:50:00.000Z',
#  'avg_speed': 58.71111111111111,
#  'travel_time': 98.10749432248298},
# {'_id': '2011-09-15T19:55:00.000Z',
#  'avg_speed': 58.90909090909091,
#  'travel_time': 97.77777777777779},
# {'_id': '2011-09-15T20:00:00.000Z',
#  'avg_speed': 58.484848484848484,
#  'travel_time': 98.48704663212436},
# {'_id': '2011-09-15T20:05:00.000Z',
#  'avg_speed': 60.111111111111114,
#  'travel_time': 95.82255083179298},
# {'_id': '2011-09-15T20:10:00.000Z',
#  'avg_speed': 59.48837209302326,
#  'travel_time': 96.82564503518374},
# {'_id': '2011-09-15T20:15:00.000Z',
#  'avg_speed': 58.666666666666664,
#  'travel_time': 98.18181818181819},
# {'_id': '2011-09-15T20:20:00.000Z',
#  'avg_speed': 59.43589743589744,
#  'travel_time': 96.91113028472822},
# {'_id': '2011-09-15T20:25:00.000Z',
#  'avg_speed': 57.63157894736842,
#  'travel_time': 99.94520547945206},
# {'_id': '2011-09-15T20:30:00.000Z',
#  'avg_speed': 61.47727272727273,
#  'travel_time': 93.6931608133087},
# {'_id': '2011-09-15T20:35:00.000Z',
#  'avg_speed': 60.09090909090909,
#  'travel_time': 95.85476550680787},
# {'_id': '2011-09-15T20:40:00.000Z',
#  'avg_speed': 60.48837209302326,
#  'travel_time': 95.22491349480968},
# {'_id': '2011-09-15T20:45:00.000Z',
#  'avg_speed': 57.06666666666667,
#  'travel_time': 100.93457943925233},
# {'_id': '2011-09-15T20:50:00.000Z',
#  'avg_speed': 59.857142857142854,
#  'travel_time': 96.2291169451074},
# {'_id': '2011-09-15T20:55:00.000Z',
#  'avg_speed': 61.84444444444444,
#  'travel_time': 93.13690262306864},
# {'_id': '2011-09-15T21:00:00.000Z',
#  'avg_speed': 61.674418604651166,
#  'travel_time': 93.39366515837105},
# {'_id': '2011-09-15T21:05:00.000Z',
#  'avg_speed': 58.55813953488372,
#  'travel_time': 98.36378077839557},
# {'_id': '2011-09-15T21:10:00.000Z',
#  'avg_speed': 60.80952380952381,
#  'travel_time': 94.72200469851214},
# {'_id': '2011-09-15T21:15:00.000Z',
#  'avg_speed': 60.56818181818182,
#  'travel_time': 95.09943714821763},
# {'_id': '2011-09-15T21:20:00.000Z',
#  'avg_speed': 60.43181818181818,
#  'travel_time': 95.3140278300113},
# {'_id': '2011-09-15T21:25:00.000Z',
#  'avg_speed': 57.65909090909091,
#  'travel_time': 99.89751675206938},
# {'_id': '2011-09-15T21:30:00.000Z',
#  'avg_speed': 58.93333333333333,
#  'travel_time': 97.73755656108598},
# {'_id': '2011-09-15T21:35:00.000Z',
#  'avg_speed': 57.325581395348834,
#  'travel_time': 100.47870182555782},
# {'_id': '2011-09-15T21:40:00.000Z',
#  'avg_speed': 59.88636363636363,
#  'travel_time': 96.1821631878558},
# {'_id': '2011-09-15T21:45:00.000Z',
#  'avg_speed': 61.81818181818182,
#  'travel_time': 93.17647058823529},
# {'_id': '2011-09-15T21:50:00.000Z',
#  'avg_speed': 58.86842105263158,
#  'travel_time': 97.84532856504246},
# {'_id': '2011-09-15T21:55:00.000Z',
#  'avg_speed': 60.775,
#  'travel_time': 94.77581242287125},
# {'_id': '2011-09-15T22:00:00.000Z',
#  'avg_speed': 61.878787878787875,
#  'travel_time': 93.08521057786486},
# {'_id': '2011-09-15T22:05:00.000Z',
#  'avg_speed': 59.275,
#  'travel_time': 97.17418810628428},
# {'_id': '2011-09-15T22:10:00.000Z',
#  'avg_speed': 60.714285714285715,
#  'travel_time': 94.87058823529412},
# {'_id': '2011-09-15T22:15:00.000Z',
#  'avg_speed': 61.57142857142857,
#  'travel_time': 93.54988399071927},
# {'_id': '2011-09-15T22:20:00.000Z',
#  'avg_speed': 60.390243902439025,
#  'travel_time': 95.37964458804524},
# {'_id': '2011-09-15T22:25:00.000Z',
#  'avg_speed': 60.23076923076923,
#  'travel_time': 95.63218390804597},
# {'_id': '2011-09-15T22:30:00.000Z',
#  'avg_speed': 55.2,
#  'travel_time': 104.34782608695652},
# {'_id': '2011-09-15T22:35:00.000Z',
#  'avg_speed': 63.51282051282051,
#  'travel_time': 90.69035123132822},
# {'_id': '2011-09-15T22:40:00.000Z',
#  'avg_speed': 60.23809523809524,
#  'travel_time': 95.62055335968378},
# {'_id': '2011-09-15T22:45:00.000Z',
#  'avg_speed': 59.833333333333336,
#  'travel_time': 96.26740947075209},
# {'_id': '2011-09-15T22:50:00.000Z',
#  'avg_speed': 63.15,
#  'travel_time': 91.21140142517815},
# {'_id': '2011-09-15T22:55:00.000Z',
#  'avg_speed': 60.666666666666664,
#  'travel_time': 94.94505494505496},
# {'_id': '2011-09-15T23:00:00.000Z',
#  'avg_speed': 60.51428571428571,
#  'travel_time': 95.18413597733712},
# {'_id': '2011-09-15T23:05:00.000Z',
#  'avg_speed': 61.973684210526315,
#  'travel_time': 92.94267515923568},
# {'_id': '2011-09-15T23:10:00.000Z',
#  'avg_speed': 63.15384615384615,
#  'travel_time': 91.20584652862362},
# {'_id': '2011-09-15T23:15:00.000Z',
#  'avg_speed': 61.64102564102564,
#  'travel_time': 93.44425956738769},
# {'_id': '2011-09-15T23:20:00.000Z',
#  'avg_speed': 61.36842105263158,
#  'travel_time': 93.85934819897084},
# {'_id': '2011-09-15T23:25:00.000Z',
#  'avg_speed': 59.24242424242424,
#  'travel_time': 97.22762148337597},
# {'_id': '2011-09-15T23:30:00.000Z',
#  'avg_speed': 59.75757575757576,
#  'travel_time': 96.38945233265721},
# {'_id': '2011-09-15T23:35:00.000Z',
#  'avg_speed': 61.029411764705884,
#  'travel_time': 94.38072289156626},
# {'_id': '2011-09-15T23:40:00.000Z',
#  'avg_speed': 61.483870967741936,
#  'travel_time': 93.68310598111228},
# {'_id': '2011-09-15T23:45:00.000Z',
#  'avg_speed': 60.294117647058826,
#  'travel_time': 95.53170731707317},
# {'_id': '2011-09-15T23:50:00.000Z',
#  'avg_speed': 61.35294117647059,
#  'travel_time': 93.8830297219559},
# {'_id': '2011-09-15T23:55:00.000Z',
#  'avg_speed': 61.83870967741935,
#  'travel_time': 93.1455399061033}]
